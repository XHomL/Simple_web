<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <!--<link href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i" rel="stylesheet">-->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css">
    <link type="text/css" rel="stylesheet" href="/css/main.css">

    <link href='http://fonts.googleapis.com/css?family=Poiret+One' rel='stylesheet' type='text/css'>


    <link href='https://fonts.googleapis.com/css?family=Lato:400,100,100italic,300italic,300,400italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Fugaz+One' rel='stylesheet' type='text/css'>


    <script src="/js/nav-hover.min.js"></script>
    <script type="text/javascript" src="/js/jquery.bxslider.min.js"></script>
    <script type="text/javascript" src="/js/main.js"></script>
    <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/jquery-cookie/1.3.0/jquery.cookie.js"></script>
    <!--<link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">-->
    <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <script src="https://cdn.bootcss.com/moment.js/2.18.1/moment-with-locales.min.js"></script>
    <!--<link href="https://cdn.bootcss.com/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker.min.css" rel="stylesheet">-->
    <script src="https://cdn.bootcss.com/bootstrap-datetimepicker/4.17.47/js/bootstrap-datetimepicker.min.js"></script>



    <title>我的主页</title>
    <link type="text/css" rel="stylesheet" href="/css/mypage.css">
  <style type="text/css">
  h1 {
    font-family: 微软雅黑;
    margin-bottom: 20px;
    margin-top: 20px;
  }
  .h2, h2{
    margin-top: 15px;
    margin-bottom: 15px;
  }

  .fdb-block .fdb-touch {
      border-top: solid 0.3125rem #af91e1;
      z-index: 2;
  }

  .rounded-circle {
      border-radius: 50% !important;
  }

  .team-members .member {
      margin: 15px auto;
      cursor: default;
      overflow: hidden;
  }
  .col-xs-4 {
      width: 33.33333333%;
      float: left;
      position: relative;
      min-height: 1px;
      padding-right: 15px;
      padding-left: 15px;
  }

  .team-members .member {
      margin: 15px auto;
      cursor: default;
      overflow: hidden;
  }

  .team-members .member a.team-image {
      display: block;
      width: 100%;
      height: auto;
      z-index: 2;
  }

  .header-text {
      position: relative;
      top: 29%;
      font-size: 35px;
      text-align: center;
      margin-bottom: 40px;
  }

  .header-text span {
      font-family: 'Allerta Stencil', sans-serif;
      padding: 8px;
      font-weight: bold;
      border-bottom: 2px solid;
  }

</style>
    <script>
        $('.testimonials-slider').bxSlider({
            slideWidth: 800,
            minSlides: 1,
            maxSlides: 1,
            slideMargin: 32,
            auto: true,
            autoControls: true
        });
    </script>
</head>
<body>
  <!-- Headers  -->
    <header class="header-wrapper">
      <div class="container">
        <nav class="navbar navbar-expand-md">
          
    
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav3" aria-controls="navbarNav3" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
    
          <div class="collapse navbar-collapse" id="navbarNav3">
            <ul class="navbar-nav ml-auto">
              <li class="nav-item active">
                <a class="nav-link" href="/home">主页 <span class="sr-only">(current)</span></a>
              </li>
              <li class="nav-item">
                <a class="nav-link" style="color: #007bce" id="photo">美照上传</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" id="bud" href="/recharge">花芽购买</a>
              </li>
                <li class="nav-item">
                    <a class="nav-link" href="/trans">花芽转花冠</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" style="color: #007bce" id="wall">照片墙</a>
                </li>
              <li class="nav-item">
                <a class="nav-link" href="/withdraw">花冠提现</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/chmsg">修改个人信息</a>
              </li>
                <li class="nav-item">
                    <a class="nav-link" style="color: #007bce" id="gift">收到的礼物</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" style="color: #007bce" id="present">送出的礼物</a>
                </li>
              <li class="nav-item">
                <a class="nav-link" href="">我的订单</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/mypage">我的</a>
              </li>
            </ul>
    
            <a class="btn btn-outline-primary ml-md-3" href="/login">退出登录</a>
          </div>
        </nav>
      </div>
    </header>

    <!-- content  -->
<div class="main" id="main">
  <h1>My Page</h1>
  <div class="content">
      <div class="profile">
          <div id="profile"></div>
          <h2 id="name"></h2>
          <p id="signature"></p>
      </div>
      <div class="main-grid3">

          <div id="skill1">
          </div>
          <div id="skill2">
          </div>
          <div id="skill3">
          </div>
      </div>
      <div class="favourites">
          <ul id="flower"></ul>
          <p>Nemo enim ipsam volup sed quia consequuntur magni dolores eos qui ratione voluptatem sequi nesciunt.</p>
      </div>
      <div class="facebook">
          <ul>
              <li><a class="icon1" href="#"></a></li>
              <li><a class="icon2" href="#"></a></li>
              <li><a class="icon3" href="#"></a></li>
              <li><a class="icon4" href="#"></a></li>
              <li><a class="icon5" href="#"></a></li>
          </ul>
      </div>
      <div class="follow">
          <a href="#">follow</a>
      </div>
  </div>
    <p class="footer">Copyright &copy; 2018.JLU All rights reserved.</p>
</div>
<!--<main role="main" class="container" id="main">-->

    <!--&lt;!&ndash;个人资料栏&ndash;&gt;-->
    <!--<div class="container col-12 mt-3">-->
        <!--<div class="media">-->
            <!--<div id="media">-->

            <!--</div>-->
            <!--<div class="media-body" id="name">-->
            <!--</div>-->

        <!--</div>-->
    <!--</div>-->
    <!--<br/>-->
    <!--<br/>-->
    <!--<div class="container col-12 mt-3">-->
        <!--<div class="media-body" id="others">-->
        <!--</div>-->
    <!--</div>-->

<!--</main>-->


      <!-- <p>这个用户还没有上传照片</p> -->

      <!--</div>-->

<script type="text/javascript">
        // if ($.cookie("timealley") !== "true")
        //     window.location.replace("register");


        // $.cookie("phoneNum","18899990004");
        //  $.cookie("phoneNum","17777777778");
        var user = new Object();
        user.phoneNum = $.cookie('phoneNum');
        if (user.phoneNum==null)
            window.location.replace("/login");



      $(document).ready(function(){

                  // $.ajax({
                  //     // url:"http://172.20.10.4:8080/getUserPhoto" ,
                  //     // url:"/getUserPhoto",
                  //     type: "POST",
                  //     contentType: "application/json",
                  //     dataType: "json",
                  //     data: JSON.stringify(user),
                  //     success: function(data){
                  //
                  //         alert("success");
                  //         if(data.length == 0){
                  //             $('#beatyContent').html('<p>这个用户还没有上传照片</p>');
                  //         }else{
                  //             for(var i=0;i<data.length;i++){
                  //                 alert(data[i]);
                  //                 $('#beatyContent').append(
                  //                     "<table border=\"1\" class=\"table\">"+
                  //                     "<div class=\"fdb-box p-0\">"+
                  //                     "<img alt=\"image\" class=\"img-fluid rounded-0\" src="+"http://172.20.10.4:8080/"+data[i]+"\" >" +
                  //
                  //
                  //                     "</div>"+
                  //                     "</div>");
                  //             }//for
                  //
                  //         }
                  //     }
                  // });

                  $.ajax({
                    url: "/getmypage",
                    // url: "/getmypage",
                    type: "POST",
                    dataType: "json",
                    contentType: "application/json",
                    data: JSON.stringify(user),
                    success: function(result){

                      var profile="<img  class=\"rounded-circle\" src="+result.profile+" alt=\" \" />";
                      $("#profile").append(profile);
                      var name = result.username;
                      $("#name").append(name);
                      var signature= "<p>" + result.signature + "</p>";
                      $("#signature").append(signature);
                      var skill1 = "<div class=\"myfont\">PhoneNum:"+result.phoneNum+"</div><br>";
                      var skill2 = "<div class=\"myfont\">Birthday:"+result.birthday+"</div><br>";
                      var skill3 = "<div class=\"myfont\">Address:"+result.address+"</div><br>";
                      $("#skill1").append(skill1);
                      $("#skill2").append(skill2);
                      $("#skill3").append(skill3);
                      var others="<li class=\"myfont\">花芽："+result.bud+"</li><li class=\"myfont\">花冠：" + result.corolla +" </li>"+ "<div class=\"clear\"></div>";
                      $("#flower").append(others);
                    }
                  })
    })


        $('#photo').click(function() {
            $("#main").empty();;


            var photo = "<div class=\"fdb-block\">\n" +
                "<div class=\"container\">\n" +
                "<div class=\"row justify-content-center\">\n" +
                "<div class=\"col-12 col-md-8 col-lg-7 col-md-5 text-center\">\n" +
                "<div class=\"fdb-box fdb-touch\">\n" +
                "<div class=\"row\">\n" +
                "<div class=\"col\" id=\"upload\">" +
                "<div class=\"row mt-4\">\n" +
                "<div class=\"col\">\n" +
                "<input type=\"file\" class=\"form-control\" name=\"File\" id=\"file\" multiple>\n" +
                "<br><img src=\"\" id=\"img0\" style='width: 100%'>"+
                "</div>\n" +
                "</div>\n" +
                "</div>\n" +
                "</div>\n" +
                "</div>\n" +
                "</div>\n" +
                "</div>\n" +
                "</div>\n" +
                "</div>";
            var submit=
                "<div class=\"row mt-4\">\n" +
                "<div class=\"col\">\n" +
                "<button class=\"btn btn-primary\" type=\"submit\" onclick =\"submit(this)\">Submit</button>\n" +
                "</div>\n" +
                "</div>";

            $("#main").append(photo);
            $("#upload").append(submit);

            $("#file").change(function() {

                var url=getObjectURL($("#file")[0].files[0]);
                if(url) {
                    $("#img0").attr("src", url);
                }
            })
        });


        $('#gift').click(function() {
            $("#main").empty();

            $.ajax({
                type:"POST",
                url:"/getAllUserReceiveRealProductionList",//连接对应后台
                dataType: "json",
                contentType: "application/json",
                async:false,
                data: JSON.stringify(user),
                error:function(data){
                    alert("连接超时");
                },
                success:function(data) {
                    $("#main").append("<table class=\"table table-striped table-advance table-hover\" id='table'></table>");
                    $("#table").html("<tr><td>用户ID</td><td>送礼人</td><td>礼物</td><td>个数</td><td>收到时间</td></tr>");
                    for (i in data) {
                        $("#table").append("<tr><td>" + data[i].userId+"</td><td>"+data[i].username +
                            "</td><td>" + data[i].productionName +
                            "</td><td>" + data[i].productionNum +
                            "</td><td>" + data[i].deliveryTime +
                            "</td><td>" + "<div class=\"btn-group\">" +
                            "<a class=\"btn btn-primary\" href=\"#\" onclick=\"glass(this)\"><i class=\"icon_plus_alt2\"></i></a>" +
                            "<a class=\"btn btn-danger\" href=\"#\"onclick=\"flower(this)\"><i class=\"icon_close_alt2\" ></i></a>" +
                            "</div>" +
                            "</td></tr>")
                    }


                }
            });

            $.ajax({
                type:"POST",
                url:"/getReceiveVirtualProductionByUserId",//连接对应后台
                dataType: "json",
                contentType: "application/json",
                data: JSON.stringify(user),
                error:function(data){
                    alert("连接超时");
                },
                success:function(data) {
                    for (i in data) {
                        $("#table").append("<tr><td>" + data[i].userId+"</td><td>"+data[i].username +
                            "</td><td>" + data[i].productionName +
                            "</td><td>" + data[i].productionNum +
                            "</td><td>" + data[i].orderTime +
                            "</td><td>" + "<div class=\"btn-group\">" +
                            "<a class=\"btn btn-primary\" href=\"#\" onclick=\"glass(this)\"><i class=\"icon_plus_alt2\"></i></a>" +
                            "<a class=\"btn btn-danger\" href=\"#\"onclick=\"flower(this)\"><i class=\"icon_close_alt2\" ></i></a>" +
                            "</div>" +
                            "</td></tr>")
                    }
                }
            });


        });


        $('#present').click(function() {
            $("#main").empty();

            $.ajax({
                type:"POST",
                url:"/getAllUserSendRealProductionList",//连接对应后台
                dataType: "json",
                contentType: "application/json",
                async:false,//同步请求，串行化执行
                data: JSON.stringify(user),
                error:function(data){
                    alert("连接超时");
                },
                success:function(data){
                    $("#main").append("<table class=\"table table-striped table-advance table-hover\" id='table'></table>");
                    $("#table").html("<tr><td>用户ID</td><td>收礼人</td><td>礼物</td><td>个数</td><td>送出时间</td></tr>");
                    for( i in data){
                        $("#table").append("<tr><td>"+data[i].userId+"</td><td>"+data[i].targetName+
                            "</td><td>"+data[i].productionName+
                            "</td><td>"+data[i].productionNum+
                            "</td><td>" + data[i].deliveryTime+
                            "</td><td>"+"<div class=\"btn-group\">"+ "</div>"+
                            "</td></tr>")
                    }
                }
            });

            $.ajax({
                type:"POST",
                url:"/getSendVirtualProductionByUserId",//连接对应后台
                dataType: "json",
                contentType: "application/json",
                data: JSON.stringify(user),
                error:function(data){
                    alert("连接超时");
                },
                success:function(data){
                    for( i in data){
                        $("#table").append("<tr><td>"+data[i].userId+"</td><td>"+data[i].targetName+
                            "</td><td>"+data[i].productionName+
                            "</td><td>"+data[i].productionNum+
                            "</td><td>" + data[i].orderTime+
                            "</td><td>"+"<div class=\"btn-group\">"+ "</div>"+
                            "</td></tr>")
                    }
                }
            });

        });

        $("#wall").click(function() {
            $("#main").empty();


            $.ajax({
                type: "POST",
                url: "/getUserPhoto",//连接对应后台
                // url: "/getPhoto",
                dataType: "json",
                contentType: "application/json",
                data: JSON.stringify(user),
                success: function (data) {
            //         var data=new Array();
            //         data[0]="\"\\upload\\屏幕截图(78).png\"";
            //         data[1]="\"\\upload\\屏幕截图(78).png\"";
            //         data[2]="\"\\upload\\屏幕截图(78).png\"";
            //         data[3]="\"\\upload\\屏幕截图(78).png\"";
            //         data[4]="\"\\upload\\屏幕截图(78).png\"";
                    $("#main").append("<div class=\"divider col-sm-12 col-xs-12 col-md-12\">\n" +
                        "          <div class=\"header-text\"><span>Gallery</span> Images</div>\n" +
                        "        </div>\n" +
                        "        <section id=\"clients\">\n" +
                        "          <div class=\"inner team\">\n" +
                        "      <div class=\"team-members inner-details\" id='pho'></div></div></section>");

                        for (i in data){
                            $("#pho").append(" <div class=\"col-xs-4 member animated\" data-animation=\"fadeInUp\" data-animation-delay=\"400\">\n" +
                                "          <div class=\"member-inner\">\n" +
                                "            <a class=\"team-image\">\n" +
                                "              <img src="+data[i]+" alt=\" \" />\n" +
                                "            </a>\n" +
                                "          </div> \n" +
                                "        </div>");
                        }

                },

            });
        })
    </script>
<script type="text/javascript">




    function glass(obj) {
        var tr = obj.parentNode.parentNode.parentNode;

        var userId = obj.parentNode.parentNode.parentNode.getElementsByTagName("td")[0].innerHTML;//找到这一行的username

        var giveback=new Object();
        giveback.userId=userId;
        giveback.phoneNum=user.phoneNum;
        giveback.status=0;

        $.ajax({
            type: "POST",
            url: "/updateRelation",
            dataType: "json",
            contentType: "application/json",
            data: JSON.stringify(giveback),
            success: function(result){
            }
        })
    }

    function flower(obj) {
        var tr = obj.parentNode.parentNode.parentNode;

        var userId = obj.parentNode.parentNode.parentNode.getElementsByTagName("td")[0].innerHTML;//找到这一行的username

        var giveback=new Object();
        giveback.userId=userId;
        giveback.phoneNum=user.phoneNum;
        giveback.status=1;

        $.ajax({
            type: "POST",
            url: "/updateRelation",
            dataType: "json",
            contentType: "application/json",
            data: JSON.stringify(giveback),
            success: function(result){
            }
        })
    }

    function submit(obj){

        var photo=new FormData();
        photo.append("userPhoto", $("#file")[0].files[0]);
        var phoneNum=$.cookie("phoneNum");
        photo.append("phoneNum",phoneNum);

       $.ajax({
           type: "POST",
           url: "/uploadUserPhoto",
           processData: false,
           contentType: false,
           data: photo,
           success: function(result){
               if(result)
                   alert("success");
               else
                   alert("error");
           }
       })

    }

    function getObjectURL(file) {
        var url = null;
        if(window.createObjectURL != undefined) { // basic
            url = window.createObjectURL(file);
        } else if(window.URL != undefined) { // mozilla(firefox)
            url = window.URL.createObjectURL(file);
        } else if(window.webkitURL != undefined) { // webkit or chrome
            url = window.webkitURL.createObjectURL(file);
        }
        return url;
    }
</script>
</body>
</html>